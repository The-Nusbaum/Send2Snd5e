<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', sans-serif; font-size: 16pt; line-height: 1.3; }
  .card { padding: 4mm 2mm; }
  .header { border-bottom: 2px solid #000; padding-bottom: 2mm; margin-bottom: 2mm; display: flex; gap: 4mm; }
  .header-text { flex: 1; }
  .header-img { width: 27mm; height: 27mm; object-fit: contain; border: 2px solid #000; order: 2; background: #000; filter: brightness(calc(100% + 25%)) grayscale(100%) contrast(1000%); }
  .name { font-size: 16pt; font-weight: bold; text-transform: uppercase; }
  .level-school { font-size: 12pt; font-style: italic; margin-top: 1mm; }
  .concentration { display: block; font-size: 11pt; font-weight: bold; text-transform: uppercase; margin-top: 1mm; }
  .ritual { display: block; font-size: 11pt; font-style: italic; margin-top: 1mm; }
  .stat { display: flex; justify-content: space-between; font-size: 14pt; border-bottom: 1px dotted #000; padding: 1mm 0; }
  .stat:last-child { border-bottom: none; }
  .stat-label { font-weight: bold; }
  .materials { font-size: 12pt; margin: 2mm 0; }
  .desc { font-size: 14pt; margin-top: 2mm; padding-top: 2mm; border-top: 2px solid #000; text-align: justify; }
  .desc p { margin-bottom: 2mm; }
  .desc p:last-child { margin-bottom: 0; }
  .higher-levels { font-size: 12pt; margin-top: 2mm; padding-top: 2mm; border-top: 1px dotted #000; }
  .higher-levels strong { font-weight: bold; }
  .source { font-size: 10pt; text-align: right; margin-top: 2mm; border-top: 1px dotted #000; padding-top: 1mm; }
</style>

<div class="card">
  <div class="header">
    {% if it.imgBase64 %}<img class="header-img" src="{{ it.imgBase64 }}" alt="">{% elif it.img %}<img class="header-img" src="{{ it.img }}" alt="">{% endif %}
    <div class="header-text">
      <div class="name">{{ it.name }}</div>
      <div class="level-school">
        {%- set schools = {"abj":"Abjuration","con":"Conjuration","div":"Divination","enc":"Enchantment","evo":"Evocation","ill":"Illusion","nec":"Necromancy","trs":"Transmutation"} -%}
        {%- if it.system.level == 0 -%}
          {{ schools[it.system.school] | default(it.system.school) }} cantrip
        {%- else -%}
          {{ it.system.level }}{{ ["st","nd","rd"][it.system.level - 1] | default("th") }}-level {{ schools[it.system.school] | default(it.system.school) | lower }}
        {%- endif -%}
      </div>
      {% if it.system.duration.concentration %}<div class="concentration">Concentration</div>{% endif %}
      {% if it.system.properties and "ritual" in it.system.properties %}<div class="ritual">(ritual)</div>{% endif %}
    </div>
  </div>

  <div class="stat">
    <span class="stat-label">Casting Time</span>
    <span>
      {%- set actTypes = {"action":"1 action","bonus":"1 bonus action","reaction":"1 reaction","minute":"minute","hour":"hour"} -%}
      {%- if it.system.activation.type in ["action","bonus","reaction"] -%}
        {{ actTypes[it.system.activation.type] }}
      {%- else -%}
        {{ it.system.activation.value }} {{ it.system.activation.type }}{% if it.system.activation.value > 1 %}s{% endif %}
      {%- endif -%}
    </span>
  </div>

  <div class="stat">
    <span class="stat-label">Range</span>
    <span>
      {%- if it.system.range.units == "self" -%}
        Self{% if it.system.target.template.size %} ({{ it.system.target.template.size }}-ft {{ it.system.target.template.type }}){% endif %}
      {%- elif it.system.range.units == "touch" -%}
        Touch
      {%- elif it.system.range.units == "spec" -%}
        Special
      {%- elif it.system.range.units == "any" -%}
        Unlimited
      {%- else -%}
        {{ it.system.range.value }} {{ it.system.range.units }}
      {%- endif -%}
    </span>
  </div>

  <div class="stat">
    <span class="stat-label">Duration</span>
    <span>
      {%- if it.system.duration.concentration %}Concentration, up to {% endif -%}
      {%- if it.system.duration.units == "inst" -%}
        Instantaneous
      {%- elif it.system.duration.units == "perm" -%}
        Until dispelled
      {%- elif it.system.duration.units == "spec" -%}
        Special
      {%- else -%}
        {{ it.system.duration.value }} {{ it.system.duration.units }}{% if it.system.duration.value > 1 %}s{% endif %}
      {%- endif -%}
    </span>
  </div>

  {% if it.system.properties %}
  <div class="stat">
    <span class="stat-label">Components</span>
    <span>
      {%- set comps = [] -%}
      {%- if "vocal" in it.system.properties %}{% set comps = comps.concat(["V"]) %}{% endif -%}
      {%- if "somatic" in it.system.properties %}{% set comps = comps.concat(["S"]) %}{% endif -%}
      {%- if "material" in it.system.properties %}{% set comps = comps.concat(["M"]) %}{% endif -%}
      {{ comps | join(", ") }}
    </span>
  </div>
  {% endif %}

  {% if it.system.materials and it.system.materials.value %}
  <div class="materials">
    <em>{{ it.system.materials.value }}{% if it.system.materials.consumed %} (consumed){% endif %}</em>
  </div>
  {% endif %}

  <div class="desc">{{ it.system.description.value | safe }}</div>

  {% if it.system.source and it.system.source.book %}
  <div class="source">{{ it.system.source.book }}{% if it.system.source.page %} p.{{ it.system.source.page }}{% endif %}</div>
  {% endif %}
</div>
